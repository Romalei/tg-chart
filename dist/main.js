"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),t}function dom(t,i){var e=document.createElement(i);return t.appendChild(e),e}var TgChart=function(){function s(t,i){var e=this;_classCallCheck(this,s),this.init(),this.container=t,this.canvas=dom(this.container,"canvas"),this.buttons=dom(this.container,"div"),this.ctx=this.canvas.getContext("2d"),s.refs.push(this),s.isListenerEnabled||(window.addEventListener("resize",this.onResize.bind(this)),s.isListenerEnabled=!0),"object"===_typeof(i)&&(console.log(i),this.data=i,this.data.columns.forEach(function(t){e.columns[t[0]]={value:t.slice(1),shown:!0}}),this.setStartEnd(1,this.sectionSize),this.setStyles(),this.createButtons(),this.calculateSize(),this.draw())}return _createClass(s,[{key:"init",value:function(){this.chartVP={},this.timeLineVP={},this.xAxisVP={},this.timeLineHeight=80,this.gridColor="#A9ABAD",this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.x0=0,this.x1=0,this.maxYForSelection=0,this.maxY=0,this.step=1,this.lineWidth=3,this.sectionSize=30,this.columns={}}},{key:"pointsCount",get:function(){return this.columns.x.value.length}}]),_createClass(s,[{key:"createButtons",value:function(){var a=this;Object.keys(this.data.names).forEach(function(i){var t=dom(a.buttons,"label");t.className="tg-chart-buttons__item";var e=dom(t,"input");e.className="tg-chart-checkbox",e.setAttribute("type","checkbox");var s=dom(t,"span");s.className="tg-chart-checkbox-indicator",s.style.setProperty("background-color",a.data.colors[i]);var n=dom(t,"span");n.innerText=a.data.names[i],n.className="tg-chart-checkbox-text",dom(t,"span").className="tg-chart-checkbox-ripple",e.addEventListener("change",function(t){return a.onBtnClick(t,i)})})}},{key:"onBtnClick",value:function(t,i){this.columns[i].shown=!t.target.checked,this.calculateMaxY(),this.draw()}},{key:"setStyles",value:function(){this.container.classList.add("tg-chart-wrapper"),this.buttons.className="tg-chart-buttons"}},{key:"calculateSize",value:function(){this.canvas.width=this.container.clientWidth,this.canvas.height=400,this.timeLineVP={x0:0,y0:this.canvas.height-this.timeLineHeight,x1:this.canvas.width,y1:this.canvas.height,height:function(){return this.y1-this.y0}},this.xAxisVP={x0:0,y0:this.timeLineVP.y0-30,x1:this.canvas.width,y1:this.timeLineVP.y0-1},this.chartVP={x0:0,y0:30,x1:this.canvas.width,y1:this.xAxisVP.y0-1,height:function(){return this.y1-this.y0}}}},{key:"onResize",value:function(){s.refs.forEach(function(t){t.canvas.width=t.container.clientWidth,t.canvas.height=400,t.calculateSize(),t.draw()})}},{key:"setStartEnd",value:function(t,i){this.x0=t,this.x1=i>this.pointsCount?this.pointsCount:i,this.calculateMaxY()}},{key:"calculateMaxY",value:function(){var e=this,s=0,n=0;Object.keys(this.columns).filter(function(t){return e.isLineCol(t)}).map(function(t){return e.columns[t].value}).forEach(function(t){t.forEach(function(t,i){s<t&&(s=t),n<t&&i>=e.x0&&i<=e.x1&&(n=t)})}),this.maxY=s,this.maxYForSelection=n}},{key:"draw",value:function(){this.clear(),this.drawGrid(),this.drawLines(),this.drawNumbers(),this.drawXAxis(),this.drawLines(0,this.pointsCount-1,this.maxY,this.timeLineVP,1)}},{key:"drawGrid",value:function(){var t,i=Math.pow(10,this.maxYForSelection.toString().length-2),e=Math.floor(Math.round(this.maxYForSelection/5/i)*i);this.ctx.lineWidth=.2,this.ctx.strokeStyle=this.gridColor;for(var s=0;s<6;s++)t=this.getY(e*s,5*e),this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.stroke()}},{key:"drawNumbers",value:function(){var t,i=Math.pow(10,this.maxYForSelection.toString().length-2),e=Math.floor(Math.round(this.maxYForSelection/5/i)*i);this.ctx.fillStyle=this.gridColor,this.ctx.font="12px sans-serif";for(var s=0;s<6;s++)t=this.getY(e*s,5*e),this.ctx.fillText(e*s,5,t-8)}},{key:"drawLines",value:function(){var t,i,e,s,n=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.x0,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.x1,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.maxYForSelection,c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.chartVP,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:this.step;this.ctx.lineWidth=this.lineWidth;for(var l=a;l<h-1;l+=r){t=this.getX(this.columns.x.value[l],a,h),e=this.getX(this.columns.x.value[l+1],a,h);var u=!0,v=!1,d=void 0;try{for(var f,x=Object.keys(this.columns).filter(function(t){return n.isLineCol(t)&&n.columns[t].shown})[Symbol.iterator]();!(u=(f=x.next()).done);u=!0){var y=f.value;i=this.getY(this.columns[y].value[l],o,c),s=this.getY(this.columns[y].value[l+1],o,c),this.ctx.beginPath(),this.ctx.strokeStyle=this.data.colors[y],this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke()}}catch(t){v=!0,d=t}finally{try{u||null==x.return||x.return()}finally{if(v)throw d}}}}},{key:"drawXAxis",value:function(){this.ctx.fillStyle=this.gridColor,this.ctx.font="12px sans-serif";for(var t=Math.floor(this.canvas.width/100),i=Math.floor((this.x1-this.x0)/t),e=this.canvas.width/t,s=0,n=this.x0;n<this.x1;n+=i){var a=new Date(this.columns.x.value[n]),h="".concat(this.months[a.getMonth()]," ").concat(a.getDate());this.ctx.fillText(h,e*s+e/3,this.xAxisVP.y0+16),s++}}},{key:"clear",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.canvas.width,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.canvas.height;this.ctx.clearRect(t,i,e,s)}},{key:"getX",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.x0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.x1;return(t-this.columns.x.value[this.x0])*this.canvas.width/(this.columns.x.value[e]-this.columns.x.value[i])}},{key:"getY",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.maxYForSelection,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.chartVP,s=e.height();return s-t*s/i+e.y0}},{key:"isLineCol",value:function(t){return"line"===this.data.types[t]}}]),s}();TgChart.refs=[],TgChart.isListenerEnabled=!1;